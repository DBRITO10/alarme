<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Alarmes â€” InÃ­cio</title>
<style>
:root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;color-scheme:dark}
*{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#071029 0%,#071422 100%);color:#e6eef6}
.container{max-width:900px;margin:20px auto;padding:18px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
h1{margin:0;font-size:20px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
.alarmes{margin-top:12px}
.alarm{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);margin-bottom:8px}
.col{display:flex;flex-direction:column}
.row{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#032;font-weight:600;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
.switch{cursor:pointer;padding:6px 10px;border-radius:6px;border:0}
.small{font-size:13px;color:var(--muted)}
.footer{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Alarmes</h1>
    <div class="row">
      <button class="btn" id="btnNovo">+ Novo Alarme</button>
      <button class="btn ghost" id="btnImport">Export</button>
    </div>
  </div>

  <div class="card">
    <div class="small">Lista de alarmes cadastrados (toque para alternar, editar ou excluir):</div>
    <div class="alarmes" id="lista"></div>
    <div class="small" style="margin-top:8px">Dica: permita notificaÃ§Ãµes e som no navegador.</div>
  </div>

  <div class="footer">Feito por vocÃª â€” Alarme Simples</div>
</div>

<script>
/* Gerenciamento de alarmes via localStorage */
const LS_KEY = 'app_alarmes_v1';
function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8); }
function load(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'[]'); }catch(e){ return []; } }
function save(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr)); }
function render(){
  const lista = document.getElementById('lista'); lista.innerHTML='';
  const arr = load().sort((a,b)=>a.time.localeCompare(b.time));
  if(arr.length===0){ lista.innerHTML='<div class="small">Nenhum alarme. Clique em "+ Novo Alarme".</div>'; return; }
  arr.forEach(a=>{
    const el = document.createElement('div'); el.className='alarm';
    const left = document.createElement('div'); left.className='col';
    const title = document.createElement('div'); title.textContent = a.time + (a.label? '  â€”  '+a.label : '');
    const sub = document.createElement('div'); sub.className='small'; sub.textContent = (a.active? 'Ativo':'Inativo') + ' â€¢ Som: '+(a.soundName||a.sound);
    left.appendChild(title); left.appendChild(sub);
    const right = document.createElement('div'); right.className='row';
    const toggle = document.createElement('button'); toggle.className='switch'; toggle.textContent = a.active? 'ðŸ”›' : 'âšª'; toggle.addEventListener('click', ()=>{ a.active = !a.active; save(arr.map(x=> x.id===a.id? a:x)); render(); });
    const edit = document.createElement('button'); edit.className='btn ghost'; edit.textContent='Editar'; edit.addEventListener('click', ()=>{ location.href = 'editar.html?id='+encodeURIComponent(a.id); });
    const del = document.createElement('button'); del.className='btn ghost'; del.textContent='Excluir'; del.addEventListener('click', ()=>{ if(confirm('Excluir alarme?')){ const n=arr.filter(x=>x.id!==a.id); save(n); render(); } });
    // quick open when active to test navigation
    const open = document.createElement('button'); open.className='btn ghost'; open.textContent='Abrir (simular)'; open.addEventListener('click', ()=>{ location.href = 'tocar.html?id='+encodeURIComponent(a.id); });
    right.appendChild(toggle); right.appendChild(edit); right.appendChild(del); right.appendChild(open);
    el.appendChild(left); el.appendChild(right);
    lista.appendChild(el);
  });
}

document.getElementById('btnNovo').addEventListener('click', ()=> location.href='novo.html');
document.getElementById('btnImport').addEventListener('click', ()=>{
  const data = JSON.stringify(load(), null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='alarmes.json'; a.click();
  URL.revokeObjectURL(url);
});

render();

/* Checagem periÃ³dica para disparo â€” fica em todas as pÃ¡ginas via interval */
setInterval(()=>{
  const arr = load();
  const now = new Date();
  const hhmm = now.toTimeString().slice(0,5);
  arr.forEach(a=>{
    if(a.active && !a._ringing){
      // support exact match and countdown flag
      if(a.time === hhmm){
        a._ringing = true; save(arr.map(x=> x.id===a.id? a:x));
        // open tocar.html for this alarm
        location.href = 'tocar.html?id='+encodeURIComponent(a.id);
      }
    }
  });
}, 1000);

</script>
</body>
</html>
