<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Editar Alarme</title>
<style>
:root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;color-scheme:dark}
*{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#071029 0%,#071422 100%);color:#e6eef6}
.container{max-width:720px;margin:20px auto;padding:18px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
label{display:block;margin-top:10px;color:var(--muted)}
input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
.row{display:grid;grid-template-columns:1fr 120px;gap:12px;margin-top:8px}
.buttons{display:flex;gap:8px;margin-top:12px}
.btn{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:#032;font-weight:600;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
.small{font-size:13px;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>Editar Alarme</h2>
    <label>Hora (HH:MM)<input id="alarmTime" type="time"></label>
    <div class="row">
      <div><label>Contagem (min)<input id="countdown" type="number" min="0" placeholder="0"></label></div>
      <div><label>Soneca (min)<input id="snooze" type="number" min="1" value="5"></label></div>
    </div>
    <label>Nome (opcional)<input id="label" type="text" placeholder="DescriÃ§Ã£o"></label>

    <label>Som
      <select id="soundSel">
        <option value="beep">Beep</option>
        <option value="melody">Melodia</option>
        <option value="alarm_clock">alarm_clock</option>
        <option value="bell">bell</option>
        <option value="chime">chime</option>
        <option value="digital">digital</option>
        <option value="buzz">buzz</option>
        <option value="horn">horn</option>
        <option value="gong">gong</option>
        <option value="bird">bird</option>
        <option value="wave">wave</option>
        <option value="rain">rain</option>
        <option value="wind">wind</option>
        <option value="flute">flute</option>
        <option value="piano">piano</option>
        <option value="guitar">guitar</option>
        <option value="drum">drum</option>
        <option value="trumpet">trumpet</option>
        <option value="harp">harp</option>
        <option value="laser">laser</option>
        <option value="siren">siren</option>
        <option value="local">ðŸŽµ MÃºsica do dispositivo...</option>
      </select>
    </label>
    <input type="file" id="fileLocal" accept="audio/*" style="display:none;margin-top:8px">
    <div class="buttons">
      <button class="btn" id="save">Salvar</button>
      <button class="btn ghost" id="cancel">Cancelar</button>
      <button class="btn ghost" id="test">Testar som</button>
    </div>
    <div class="small">Editar e depois salve. </div>
  </div>
</div>

<script>
const LS_KEY='app_alarmes_v1';
function load(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'[]') }catch(e){return[]} }
function save(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr)) }

const params = new URLSearchParams(location.search);
const id = params.get('id');
if(!id){ alert('ID ausente'); location.href='index.html'; }

let arr = load();
let item = arr.find(x=>x.id===id);
if(!item){ alert('Alarme nÃ£o encontrado'); location.href='index.html'; }

document.getElementById('alarmTime').value = item.time || '';
document.getElementById('countdown').value = item.countdown || 0;
document.getElementById('snooze').value = item.snooze || 5;
document.getElementById('label').value = item.label || '';
document.getElementById('soundSel').value = item.sound || 'beep';

const fileLocal = document.getElementById('fileLocal');
let previewAudio = null;
let userAudioURL = item.userAudio || null;

document.getElementById('soundSel').addEventListener('change', ()=>{
  if(document.getElementById('soundSel').value==='local') fileLocal.style.display='block'; else fileLocal.style.display='none';
});

fileLocal.addEventListener('change', e=>{
  const f = e.target.files[0];
  if(f) userAudioURL = URL.createObjectURL(f);
});

document.getElementById('test').addEventListener('click', ()=>{
  if(previewAudio){ previewAudio.pause(); previewAudio=null; document.getElementById('test').textContent='Testar som'; return; }
  if(userAudioURL){ previewAudio = new Audio(userAudioURL); previewAudio.play(); document.getElementById('test').textContent='Pausar som'; return; }
  const val = document.getElementById('soundSel').value;
  const a = new Audio('https://actions.google.com/sounds/v1/alarms/'+val+'.ogg'); previewAudio=a; a.play(); document.getElementById('test').textContent='Pausar som';
});

document.getElementById('cancel').addEventListener('click', ()=> location.href='index.html');
document.getElementById('save').addEventListener('click', ()=>{
  const time = document.getElementById('alarmTime').value;
  const countdown = Number(document.getElementById('countdown').value||0);
  const snooze = Number(document.getElementById('snooze').value||5);
  const label = document.getElementById('label').value||'';
  const sound = document.getElementById('soundSel').value;
  if(!time && !countdown){ alert('Defina hora ou contagem regressiva'); return; }
  item.time = time; item.countdown = countdown; item.snooze = snooze; item.label = label; item.sound = sound; item.userAudio = userAudioURL; item.soundName = (sound==='local' && fileLocal.files[0])? fileLocal.files[0].name : sound;
  save(arr);
  alert('Alarme atualizado'); location.href='index.html';
});
</script>
</body>
</html>
